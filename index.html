<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Screen Recording</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    h1 { text-align: center; }
    ol { margin-top: 1em; }
    button { font-size: 1.1em; margin: 10px 5px; padding: 10px 20px; }
    a { color: blue; text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Study Instructions</h1>
  <ol>
    <li><strong>Read all instructions carefully.</strong> Understand the task before you begin.</li>
    <li>Open the <a href="https://playspent.org/" target="_blank" rel="noopener noreferrer" id="gameLink">Spent Game</a> in a new tab.</li>
    <li>Click <strong>Start Recording</strong> below and select the <em>Spent</em> game tab or your full screen to share.</li>
    <li>Play the game according to the instructions on the game page.</li>
    <li>When done, either click <strong>Stop Recording</strong> button here, or manually stop screen sharing from your browser toolbar. The recording will then download automatically and you will be redirected to the post-survey page.</li>
  </ol>

  <div style="text-align:center; margin-top: 20px;">
    <button id="startBtn">Start Recording</button>
    <button id="stopBtn" disabled>Stop Recording</button>
  </div>

<script>
    const redirectURL = 'https://www.butler.edu/';

    let mediaRecorder;
    let recordedChunks = [];

    document.getElementById('startBtn').onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });
        recordedChunks = [];

        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.style.display = 'none';
          a.href = url;
          a.download = 'recording.webm';
          document.body.appendChild(a);
          a.click();
          setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            window.location.href = redirectURL;
          }, 1000);
        };

        mediaRecorder.start();
        document.getElementById('startBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;
        alert('Recording started. Now switch to Spent tab or screen.');
      } catch (err) {
        alert('Error accessing display media: ' + err);
      }
    };

    document.getElementById('stopBtn').onclick = () => {
      if(mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
      }
      document.getElementById('startBtn').disabled = false;
      document.getElementById('stopBtn').disabled = true;
    };
  </script>
</body>
</html>

